<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>UberList</title>
    <script src="knockout-3.2.0.debug.js"></script>
    <script src="jquery-2.1.1.js"></script>
    <script src="listItemViewModel.js"></script>
</head>
<body>
    <input data-bind="value: search, valueUpdate: 'input'" />
    <input type="button" data-bind="click: filterNodes" value="Search" />
    <input type="button" data-bind="click: clearFilter" value="Clear" />
    <p>
        <input data-bind="value: newListName"/>
        <button data-bind="click: NewList">Make a New List</button>
        <button data-bind="click: DeleteList, enable: lists().length > 1">Delete this List</button>
    </p>

    <div data-bind="foreach: displayNodes">
        <h1 data-bind="text: text"></h1>
        <button data-bind="click: AddNode">+</button>
        <!-- ko template: "list-item-template" --><!-- /ko -->
    </div>

    <script id="list-item-template" type="text/html">
        <ol data-bind="foreach: children">
            <li>
                <a href="#" data-bind="click: $parent.ToggleVisible, text: collapsed() ? '+' : '-', visible: children().length"></a>
                <input data-bind="value: text" />
                <input type="checkbox" data-bind="checked: complete" />
                <button data-bind="click: $parent.AddNodeSameLevel">V</button>
                <button data-bind="click: $parent.AddNode">></button>
                <button data-bind="click: $parent.RemoveNode">-</button>
                <div data-bind="visible: !collapsed()">
                    <!-- ko template: { name: "list-item-template" } --><!-- /ko -->
                </div>
            </li>
        </ol>
    </script>

    <script>
        
            var newListName = ko.observable("new list");
            var currentListIndex = 0;
            var currentList;

            var NewList = function (values) {
                var tempItem = ko.observableArray([{text: newListName(), complete: false}]);
                tempItem.text = newListName();
                values.lists.push(tempItem);
                currentListIndex = values.lists().length-1;
                currentList = values.lists()[currentListIndex];
                values.loadList(currentList);
            }

            var DeleteList = function (values) {
                values.loadList(values.lists()[currentListIndex-1]);
                values.lists.remove(values.lists()[currentListIndex]);
                currentListIndex--;
            }

        $(function () {
            var data = [
            {
                text: "Shopping",
                complete: false,
                children: [
                    {
                        text: "Produce",
                        complete: false,
                        children: [
                            { text: "Lettuce", complete: false },
                            { text: "Tomatoes", complete: false },
                            { text: "Apples", complete: false },
                            { text: "Potatoes", complete: false },
                        ]
                    },
                    {
                        text: "Dairy",
                        complete: false,
                        children: [
                            { text: "Milk", complete: false },
                            { text: "Cheese", complete: false },
                        ]
                    },
                    {
                        text: "Frozen",
                        complete: false,
                        children: [
                            { text: "Pizza", complete: false },
                            { text: "Ice Cream", complete: false },
                            { text: "Waffles", complete: false },
                        ]
                    }
                ]
            }
            ];

            var vm = listItemViewModel.init();
            vm.lists(data);
            vm.loadList(data[0]);
            ko.applyBindings(vm);
        }());
    </script>
</body>

</html>