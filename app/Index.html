<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>UberList</title>
        <script src="knockout-3.2.0.debug.js"></script>        
        <script src="jquery-2.1.1.js"></script>
    </head>
<body>
    <div data-bind="with: rootNode">
        <h1 data-bind="text: text"></h1>
        <list-item params="node: $data"></list-item>

    </div>

    <script>
        $(function () {
            ko.components.register("list-item", {
                viewModel: function (param) {
                    var node = ko.utils.unwrapObservable(param.node);
                    var vm = this;
                    this.text = ko.observable(ko.utils.unwrapObservable(node.text));
                    this.complete = ko.observable(node.complete);
                    this.children = ko.observableArray(ko.utils.unwrapObservable(node.children) || []);

                    <!-- add and remove functions-->
                    this.AddNode = function(context) {
                        console.log(vm);
                        var node = ko.observable({text: "text", complete: false, children: []});
                        node.children = ko.observableArray(node.children || []);
                        ko.contextFor(arguments[1].target).$data.children.push(node);
                    }
                },
                template: '<div>\
                                <ol data-bind="foreach: children">\
                                    <li><input data-bind="value: text"/>\
                                    <input type="checkbox" data-bind="checked: complete"/>\
                                    <button data-bind="click: $parent.AddNode">+</button>\
                                    </li>\
                                    <list-item params="node: $data"></list-item>\
                                </ol>\
                            </div>'
            });

            var data = {
                root: {
                    text: "Shopping", complete: false,
                    children: [
                        {
                            text: "Produce", complete: false,
                            children: [
                                { text: "Lettuce", complete: false },
                                { text: "Tomatoes", complete: false },
                                { text: "Apples", complete: false },
                                { text: "Potatoes", complete: false },
                            ]
                        },
                        {
                            text: "Dairy", complete: false,
                            children: [
                                { text: "Milk", complete: false },
                                { text: "Cheese", complete: false },
                            ]
                        },
                        {
                            text: "Frozen", complete: false,
                            children: [
                                { text: "Pizza", complete: false },
                                { text: "Ice Cream", complete: false },
                                { text: "Waffles", complete: false },
                            ]
                        }
                    ]
                }
            }

            

            var vm = {
                rootNode: ko.observable(),
            }

            vm.rootNode({
                text: ko.observable(data.root.text),
                children: ko.observableArray(data.root.children),
            });

            ko.applyBindings(vm);
        }());
    </script>
</body>

</html>